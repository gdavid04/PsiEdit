(async()=>{(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const o of document.querySelectorAll('link[rel="modulepreload"]'))n(o);new MutationObserver(o=>{for(const a of o)if(a.type==="childList")for(const r of a.addedNodes)r.tagName==="LINK"&&r.rel==="modulepreload"&&n(r)}).observe(document,{childList:!0,subtree:!0});function t(o){const a={};return o.integrity&&(a.integrity=o.integrity),o.referrerPolicy&&(a.referrerPolicy=o.referrerPolicy),o.crossOrigin==="use-credentials"?a.credentials="include":o.crossOrigin==="anonymous"?a.credentials="omit":a.credentials="same-origin",a}function n(o){if(o.ep)return;o.ep=!0;const a=t(o);fetch(o.href,a)}})();function we(...e){let t=document.createElement("div");return t.classList.add(...e),t}Node.prototype.div=function(...e){let t=we(...e);return this.append(t),t};async function Q(e){let t=await fetch(e).then(n=>n.text());return new DOMParser().parseFromString(t,"text/html")}async function he(e){return fetch(e).then(t=>t.json())}function ve(e,t,n){return Math.max(t,Math.min(n,e))}function O(e,t){return ve(e,0,t-1)}function Y(e,t){return e>=0&&e<t}const G=["target","number","number1","number2","number3","number4","vector1","vector2","vector3","vector4","position","min","max","power","x","y","z","radius","distance","time","base","ray","vector","axis","angle","pitch","instrument","volume","list1","list2","list","direction","from1","from2","to1","to2","root","toggle","mask","channel","slot","ray_end","ray_start"];function E(e,t){j(e),e.element.append(t),e.piece=t}function j(e){e.piece&&(e.piece.remove(),e.piece=null)}function q(e){return e.cloneNode(!0)}function k(e,t,n=null,o=null){e.dataset.side=t,o&&w(o,n);let a=e.parentNode.querySelector(`.line[data-trigger='${e.dataset.key}']`);a&&(a.dataset.side=t)}function R(e){return e.dataset.side}function W(e){return e.dataset.optional!=null}function Z(e){return e.dataset.sortingName.toLowerCase()}let ee,te,ne,re;Q("controls.html").then(e=>{ee=e.querySelector(".param-control"),re=e.querySelector(".related-control"),te=e.querySelector(".value-control"),ne=e.querySelector(".text-control")});function w(e,t){if(ke(e),!t.cell||!t.cell.piece)return;let n=t.cell.piece;if(e.element.style.setProperty("--piece-name",'"'+n.dataset.name+'"'),e.element.style.setProperty("--piece-desc",'"'+n.dataset.desc+'"'),n.querySelectorAll(".param").forEach(o=>{let a=ee.cloneNode(!0);a.style.setProperty("--param-name",'"'+o.dataset.name+'"'),o.dataset.color!=null&&(a.dataset.color=o.dataset.color),o.dataset.side!=null&&(a.dataset.side=o.dataset.side),o.dataset.optional!=null&&(a.dataset.optional=o.dataset.optional),a.querySelectorAll("[data-side]").forEach(r=>r.addEventListener("click",()=>{k(o,r.dataset.side,t,e)})),e.element.append(a),e.controls.push(a),e.params.push(o)}),n.dataset.key=="psi:constant_number"){let o=te.cloneNode(!0);o.style.setProperty("--param-name",'"Value"'),o.dataset.color="gray";let a=o.querySelector("[data-value]");a.value=n.querySelector("[data-value]").textContent,a.addEventListener("input",()=>{let r=n.querySelector("[data-value]");r.textContent=a.value=a.value.substring(0,5),r.style.setProperty("--scale-value",[1,1,.8,.7,.6,.5][a.value.length-1])}),e.element.append(o),e.controls.push(o)}{let o=ne.cloneNode(!0);o.style.setProperty("--param-name",'"Comment"'),o.dataset.color="gray";let a=o.querySelector("[data-value]");a.value=(n.dataset.comment||"").replaceAll(";",`
`),a.addEventListener("input",()=>n.dataset.comment=a.value.replaceAll(`
`,";")),e.element.append(o),e.controls.push(o),e.comment=a}if(n.dataset.related)for(let o of n.dataset.related.split(" ")){let a=re.cloneNode(!0);a.style.setProperty("--param-name",'"'+o.substring(0,o.indexOf("="))+'"'),a.dataset.color="gray";let r=a.querySelector("[data-pieces]");for(let s of o.substring(o.indexOf("=")+1).split(",")){let l=r.div("catalog-item"),i=s.includes(":")?s:n.dataset.key.substring(0,n.dataset.key.indexOf(":"))+":"+s;l.append(A[i].cloneNode(!0)),l.addEventListener("click",()=>{E(t.cell,q(A[i])),w(e,t)})}e.element.append(a),e.controls.push(a)}}function ke(e){e.element.style.removeProperty("--piece-name"),e.element.style.removeProperty("--piece-desc"),e.controls.forEach(t=>t.remove()),e.controls=[],e.params=[],e.values=[],e.comment=null}async function Se(e){let t={},n,o,a;if(e.querySelectorAll("meta").forEach(r=>{n=n||r.dataset.repo,o=o||r.dataset.namespace}),!n||!o)return console.error("Missing metadata in piece list"),t;e.querySelectorAll("[data-icon]").forEach(r=>{r.style.setProperty("--icon",`url('https://raw.githubusercontent.com/${n}/master/src/main/resources/assets/${o}/textures/spell/${r.dataset.icon}.png')`)});try{a=await he(`https://raw.githubusercontent.com/${n}/master/src/main/resources/assets/${o}/lang/en_us.json`)}catch{}return a=a||{},e.querySelectorAll(".piece").forEach(r=>{n&&o&&r.style.setProperty("--piece-icon",`url('https://raw.githubusercontent.com/${n}/master/src/main/resources/assets/${o}/textures/spell/${r.dataset.icon||r.dataset.type}.png')`),r.dataset.name=r.dataset.name||a[`${o}.spellpiece.${r.dataset.type}`]||`${o}.spellpiece.${r.dataset.type}`,r.dataset.desc=r.dataset.desc||a[`${o}.spellpiece.${r.dataset.type}.desc`]||`${o}.spellpiece.${r.dataset.type}.desc`,r.dataset.key=r.dataset.key||`${o}:${r.dataset.type}`,r.dataset.sortingName=r.dataset.sortingName||r.dataset.name,r.dataset.tooltip=r.dataset.name+`
`+r.dataset.desc,t[r.dataset.key]=r}),t}function Ae(e,t=!1){if(t){let r=[],s=new TextEncoder().encode(e.dataset.key);if(s.length>255)throw new Error("Key too long");r.push(new Uint8Array([s.length&255])),r.push(s);let l=new TextEncoder().encode(e.dataset.comment||"");if(l.length>65535)throw new Error("Comment too long");r.push(new Uint8Array([l.length&255,l.length>>8&255])),r.push(l);let i={};if(e.querySelectorAll(".param").forEach(_=>{_.dataset.side!="off"&&(i[_.dataset.key]=ae(_.dataset.side))}),Object.keys(i).length>255)throw new Error("Too many params");r.push(new Uint8Array([Object.keys(i).length&255]));for(let _ in i){if(_.startsWith("_")&&G.includes(_.substring(1)))r.push(new Uint8Array([255,G.indexOf(_.substring(1))]));else{let x=new TextEncoder().encode(_);if(_.length>254)throw new Error("Param key too long");r.push(new Uint8Array([x.length&255])),r.push(x)}r.push(new Uint8Array([i[_]&255]))}if(e.dataset.key=="psi:constant_number"){let _=e.querySelector("[data-value]").textContent,x=new TextEncoder().encode(_);r.push(new Uint8Array([x.length&255])),r.push(x)}let m=new Uint8Array(r.map(_=>_.length).reduce((_,x)=>_+x)),v=0;for(let _ of r)m.set(_,v),v+=_.length;return m}let n={},o=!1;e.querySelectorAll(".param").forEach(r=>{n[r.dataset.key]=ae(r.dataset.side),o=!0});let a={key:e.dataset.key};return e.dataset.comment!=""&&(a.comment=e.dataset.comment),o&&(a.params=n),e.dataset.key=="psi:constant_number"&&(a.constantValue=e.querySelector("[data-value]").textContent),a}function oe(e){if(e instanceof Uint8Array){let n=0,o=e[n++],a=new TextDecoder().decode(e.slice(n,n+o)),r=q(A[a]);n+=o;let s=e[n++]|e[n++]<<8;r.dataset.comment=new TextDecoder().decode(e.slice(n,n+s)),n+=s;let l=e[n++];for(let i=0;i<l;i++){let m=e[n++],v;m==255?v="_"+G[e[n++]]:(v=new TextDecoder().decode(e.slice(n,n+m)),n+=m);let _=e[n++];k(r.querySelector(`.param[data-key="${v}"]`),se(_))}if(a=="psi:constant_number"){let i=e[n++],m=new TextDecoder().decode(e.slice(n,n+i));n+=i;let v=r.querySelector("[data-value]");v.textContent=m,v.style.setProperty("--scale-value",[1,1,.8,.7,.6,.5][m.length-1])}return r}let t=q(A[e.key]);if(e.params)for(const[n,o]of Object.entries(e.params))k(t.querySelector(`.param[data-key="${n}"]`),se(o));if(e.comment&&(t.dataset.comment=e.comment),e.constantValue){let n=t.querySelector("[data-value]");n.textContent=e.constantValue,n.style.setProperty("--scale-value",[1,1,.8,.7,.6,.5][e.constantValue.length-1])}return t}function ae(e){return{off:0,top:1,bottom:2,left:3,right:4}[e||"off"]}function se(e){return["off","top","bottom","left","right"][e]}function xe(e){return{left:"right",right:"left",top:"bottom",bottom:"top",off:"off"}[e]}function Ee(e,t,n=null){if(!t.cell||!t.cell.piece)return!1;let o=t.cell.piece;if(o.dataset.key=="psi:constant_number"){if("FDfd".includes(e))return!1;let a=o.querySelector("[data-value]"),r=a.textContent;if(e=="Backspace")r.startsWith(".")?r="0"+r:r.startsWith("-.")&&(r="-0"+r.substring(1)),r=="-0"?r="0":r.startsWith("-")&&r.length==2?r="-0":r=r.substring(0,r.length-1).trim();else if((r=="0"||r=="-0")&&e!="-"&&e!="+"&&(r=r.replace("0","")),e=="+"?r.startsWith("-")&&(r=r.substring(1)):e=="-"?r.startsWith("-")||(r="-"+r):r=(r+e).trim(),r.length>5?r.startsWith("0.")?r=r.substring(1):r.startsWith("-0.")&&(r="-"+r.substring(2)):r.startsWith(".")?r="0"+r:r.startsWith("-.")&&(r="-0"+r.substring(1)),r.length>5)return!1;return r==""&&(r="0"),isNaN(parseFloat(r))?!1:(a.textContent=r,a.style.setProperty("--scale-value",[1,1,.8,.7,.6,.5][r.length-1]),n&&w(n,t),!0)}return!1}let le="PsiEdit",ie=[];function qe(e,t,n,o=null,a=null){let r=[];for(let s=0;s<t;s++){r[s]=[];for(let l=0;l<n;l++)r[s][l]=Le(e,r,s,l,o,a)}return r.width=t,r.height=n,r}function Le(e,t,n,o,a=null,r=null){let s={element:e.div("cell"),piece:null};return a&&(s.element.addEventListener("mousedown",l=>{l.button==0?I(t,r,n,o,a):l.button==2&&(j(s),w(a,r))}),["top","bottom"].forEach(l=>["left","right"].forEach(i=>s.element.div("selection",l,i)))),s}function I(e,t,n,o,a=null){t.x==n&&t.y==o||(t.cell&&t.cell.element.classList.remove("selected"),t.x=n,t.y=o,t.cell=e[n][o],t.cell.element.classList.add("selected"),a&&w(a,t))}function ce(e,t=!1){let n=[],o=new Uint8Array(Math.ceil(e.width*e.height/8)),a=0,r=0;for(let s=0;s<e.width;s++)for(let l=0;l<e.height;l++){if(a=a<<1&255,e[s][l].piece){a|=1;let i=Ae(e[s][l].piece,t);if(t){if(i.length>65535)throw new Error("Piece data too large");n.push(new Uint8Array([i.length>>0&255,i.length>>8&255])),n.push(i)}else n.push({x:s,y:l,data:i})}++r%8==0&&o.set([a],r/8-1)}if(r%8!=0&&o.set([a],r/8),t){let s=new Uint8Array(o.length+n.map(i=>i.length).reduce((i,m)=>i+m));s.set(o,0);let l=o.length;for(let i of n)s.set(i,l),l+=i.length;return s}else return{modsRequired:ie,validSpell:!0,spellName:le,spellList:n}}function L(e,t){for(let n=0;n<t.width;n++)for(let o=0;o<t.height;o++)j(t[n][o]);if(e instanceof Uint8Array){let n=e.subarray(0,Math.ceil(t.width*t.height/8)),o=0,a=n.length;for(let r=0;r<t.width;r++)for(let s=0;s<t.height;s++){if(n[Math.floor(o/8)]>>7-o%8&1){let l=e[a+0]<<0|e[a+1]<<8,i=oe(e.subarray(a+2,a+l+2));E(t[r][s],i),a+=l+2}o++}}else{ie=e.modsRequired,le=e.spellName;for(let n of e.spellList)E(t[n.x][n.y],oe(n.data))}}function ue(e){let t=new Map,n=256;for(let s=0;s<256;s++)t.set(s,String.fromCharCode(s));let o="",a,r;for(let s=0;s<e.length;s+=2){let l=e.charCodeAt(s)+(e.charCodeAt(s+1)<<8),i;if(t.has(l))i=t.get(l);else{if(s==0||l!=n)throw"Invalid input";i=a+r}if(o+=i,r=i[0],s>0&&(t.set(n,a+r),n++==65536))throw"Input too large";a=i}return o}let u;const h=new Array(128).fill(void 0);h.push(void 0,null,!0,!1);function c(e){return h[e]}let $=h.length;function $e(e){e<132||(h[e]=$,$=e)}function y(e){const t=c(e);return $e(e),t}const de=new TextDecoder("utf-8",{ignoreBOM:!0,fatal:!0});de.decode();let U=null;function M(){return(U===null||U.byteLength===0)&&(U=new Uint8Array(u.memory.buffer)),U}function N(e,t){return de.decode(M().subarray(e,e+t))}function d(e){$===h.length&&h.push(h.length+1);const t=$;return $=h[t],h[t]=e,t}let S=0;const D=new TextEncoder("utf-8"),Ue=typeof D.encodeInto=="function"?function(e,t){return D.encodeInto(e,t)}:function(e,t){const n=D.encode(e);return t.set(n),{read:e.length,written:n.length}};function P(e,t,n){if(n===void 0){const l=D.encode(e),i=t(l.length);return M().subarray(i,i+l.length).set(l),S=l.length,i}let o=e.length,a=t(o);const r=M();let s=0;for(;s<o;s++){const l=e.charCodeAt(s);if(l>127)break;r[a+s]=l}if(s!==o){s!==0&&(e=e.slice(s)),a=n(a,o,o=s+e.length*3);const l=M().subarray(a+s,a+o),i=Ue(e,l);s+=i.written}return S=s,a}function K(e){return e==null}let T=null;function f(){return(T===null||T.byteLength===0)&&(T=new Int32Array(u.memory.buffer)),T}let C=null;function Ne(){return(C===null||C.byteLength===0)&&(C=new Float64Array(u.memory.buffer)),C}function z(e){const t=typeof e;if(t=="number"||t=="boolean"||e==null)return`${e}`;if(t=="string")return`"${e}"`;if(t=="symbol"){const a=e.description;return a==null?"Symbol":`Symbol(${a})`}if(t=="function"){const a=e.name;return typeof a=="string"&&a.length>0?`Function(${a})`:"Function"}if(Array.isArray(e)){const a=e.length;let r="[";a>0&&(r+=z(e[0]));for(let s=1;s<a;s++)r+=", "+z(e[s]);return r+="]",r}const n=/\[object ([^\]]+)\]/.exec(toString.call(e));let o;if(n.length>1)o=n[1];else return toString.call(e);if(o=="Object")try{return"Object("+JSON.stringify(e)+")"}catch{return"Object"}return e instanceof Error?`${e.name}: ${e.message}
${e.stack}`:o}function H(e,t){try{return e.apply(this,t)}catch(n){u.__wbindgen_export_2(d(n))}}function fe(e){try{const a=u.__wbindgen_add_to_stack_pointer(-16),r=P(e,u.__wbindgen_export_0,u.__wbindgen_export_1),s=S;u.snbtToSpell(a,r,s);var t=f()[a/4+0],n=f()[a/4+1],o=f()[a/4+2];if(o)throw y(n);return y(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function _e(e){try{const a=u.__wbindgen_add_to_stack_pointer(-16),r=P(e,u.__wbindgen_export_0,u.__wbindgen_export_1),s=S;u.urlSafeToSpell(a,r,s);var t=f()[a/4+0],n=f()[a/4+1],o=f()[a/4+2];if(o)throw y(n);return y(t)}finally{u.__wbindgen_add_to_stack_pointer(16)}}function Pe(e){try{const l=u.__wbindgen_add_to_stack_pointer(-16);u.spellToUrlSafe(l,d(e));var t=f()[l/4+0],n=f()[l/4+1],o=f()[l/4+2],a=f()[l/4+3],r=t,s=n;if(a)throw r=0,s=0,y(o);return N(r,s)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_export_3(r,s)}}function Te(e){try{const l=u.__wbindgen_add_to_stack_pointer(-16);u.spellToSnbt(l,d(e));var t=f()[l/4+0],n=f()[l/4+1],o=f()[l/4+2],a=f()[l/4+3],r=t,s=n;if(a)throw r=0,s=0,y(o);return N(r,s)}finally{u.__wbindgen_add_to_stack_pointer(16),u.__wbindgen_export_3(r,s)}}async function Ce(e,t){if(typeof Response=="function"&&e instanceof Response){if(typeof WebAssembly.instantiateStreaming=="function")try{return await WebAssembly.instantiateStreaming(e,t)}catch(o){if(e.headers.get("Content-Type")!="application/wasm")console.warn("`WebAssembly.instantiateStreaming` failed because your server does not serve wasm with `application/wasm` MIME type. Falling back to `WebAssembly.instantiate` which is slower. Original error:\n",o);else throw o}const n=await e.arrayBuffer();return await WebAssembly.instantiate(n,t)}else{const n=await WebAssembly.instantiate(e,t);return n instanceof WebAssembly.Instance?{instance:n,module:e}:n}}function Oe(){const e={};return e.wbg={},e.wbg.__wbg_get_27fe3dac1c4d0224=function(t,n){const o=c(t)[n>>>0];return d(o)},e.wbg.__wbg_length_e498fbc24f9c1d4f=function(t){return c(t).length},e.wbg.__wbg_next_88560ec06a094dea=function(){return H(function(t){const n=c(t).next();return d(n)},arguments)},e.wbg.__wbg_done_1ebec03bbd919843=function(t){return c(t).done},e.wbg.__wbg_value_6ac8da5cc5b3efda=function(t){const n=c(t).value;return d(n)},e.wbg.__wbindgen_object_drop_ref=function(t){y(t)},e.wbg.__wbg_iterator_55f114446221aa5a=function(){return d(Symbol.iterator)},e.wbg.__wbg_get_baf4855f9a986186=function(){return H(function(t,n){const o=Reflect.get(c(t),c(n));return d(o)},arguments)},e.wbg.__wbindgen_is_function=function(t){return typeof c(t)=="function"},e.wbg.__wbg_call_95d1ea488d03e4e8=function(){return H(function(t,n){const o=c(t).call(c(n));return d(o)},arguments)},e.wbg.__wbindgen_is_object=function(t){const n=c(t);return typeof n=="object"&&n!==null},e.wbg.__wbg_next_b7d530c04fd8b217=function(t){const n=c(t).next;return d(n)},e.wbg.__wbindgen_string_new=function(t,n){const o=N(t,n);return d(o)},e.wbg.__wbg_new_b525de17f44a8943=function(){const t=new Array;return d(t)},e.wbg.__wbg_set_17224bc548dd1d7b=function(t,n,o){c(t)[n>>>0]=y(o)},e.wbg.__wbg_isArray_39d28997bf6b96b4=function(t){return Array.isArray(c(t))},e.wbg.__wbg_instanceof_ArrayBuffer_a69f02ee4c4f5065=function(t){let n;try{n=c(t)instanceof ArrayBuffer}catch{n=!1}return n},e.wbg.__wbg_isSafeInteger_8c4789029e885159=function(t){return Number.isSafeInteger(c(t))},e.wbg.__wbg_entries_4e1315b774245952=function(t){const n=Object.entries(c(t));return d(n)},e.wbg.__wbg_new_f9876326328f45ed=function(){const t=new Object;return d(t)},e.wbg.__wbg_length_27a2afe8ab42b09f=function(t){return c(t).length},e.wbg.__wbindgen_memory=function(){const t=u.memory;return d(t)},e.wbg.__wbg_buffer_cf65c07de34b9a08=function(t){const n=c(t).buffer;return d(n)},e.wbg.__wbg_new_537b7341ce90bb31=function(t){const n=new Uint8Array(c(t));return d(n)},e.wbg.__wbg_set_17499e8aa4003ebd=function(t,n,o){c(t).set(c(n),o>>>0)},e.wbg.__wbg_instanceof_Uint8Array_01cebe79ca606cca=function(t){let n;try{n=c(t)instanceof Uint8Array}catch{n=!1}return n},e.wbg.__wbindgen_error_new=function(t,n){const o=new Error(N(t,n));return d(o)},e.wbg.__wbg_String_88810dfeb4021902=function(t,n){const o=String(c(n)),a=P(o,u.__wbindgen_export_0,u.__wbindgen_export_1),r=S;f()[t/4+1]=r,f()[t/4+0]=a},e.wbg.__wbg_getwithrefkey_5e6d9547403deab8=function(t,n){const o=c(t)[c(n)];return d(o)},e.wbg.__wbindgen_is_undefined=function(t){return c(t)===void 0},e.wbg.__wbindgen_in=function(t,n){return c(t)in c(n)},e.wbg.__wbindgen_string_get=function(t,n){const o=c(n),a=typeof o=="string"?o:void 0;var r=K(a)?0:P(a,u.__wbindgen_export_0,u.__wbindgen_export_1),s=S;f()[t/4+1]=s,f()[t/4+0]=r},e.wbg.__wbindgen_number_get=function(t,n){const o=c(n),a=typeof o=="number"?o:void 0;Ne()[t/8+1]=K(a)?0:a,f()[t/4+0]=!K(a)},e.wbg.__wbindgen_jsval_loose_eq=function(t,n){return c(t)==c(n)},e.wbg.__wbg_set_841ac57cff3d672b=function(t,n,o){c(t)[y(n)]=y(o)},e.wbg.__wbindgen_number_new=function(t){return d(t)},e.wbg.__wbindgen_is_string=function(t){return typeof c(t)=="string"},e.wbg.__wbindgen_boolean_get=function(t){const n=c(t);return typeof n=="boolean"?n?1:0:2},e.wbg.__wbindgen_object_clone_ref=function(t){const n=c(t);return d(n)},e.wbg.__wbindgen_debug_string=function(t,n){const o=z(c(n)),a=P(o,u.__wbindgen_export_0,u.__wbindgen_export_1),r=S;f()[t/4+1]=r,f()[t/4+0]=a},e.wbg.__wbindgen_throw=function(t,n){throw new Error(N(t,n))},e}function je(e,t){return u=e.exports,ge.__wbindgen_wasm_module=t,C=null,T=null,U=null,u}async function ge(e){typeof e>"u"&&(e=new URL("/assets/psi_spell_encode_wasm_bg-700d8052.wasm",self.location));const t=Oe();(typeof e=="string"||typeof Request=="function"&&e instanceof Request||typeof URL=="function"&&e instanceof URL)&&(e=fetch(e));const{instance:n,module:o}=await Ce(await e,t);return je(n,o)}function Re(){let e=new URLSearchParams(location.search);if(e.has("cursor")){let[t,n]=e.get("cursor").split(/-?/).map(o=>parseInt(o)-1);I(b,g,O(t,F),O(n,B))}if(e.has("spell")){let t=e.get("spell").match(/^([LG])?(?:([0-9]+)-)?(.*)$/),n=t[1],o=t[2],a=t[3];if(o==1)switch(n){case"L":L(new Uint8Array([...ue(atob(a))].map(r=>r.charCodeAt())),b);break;case"G":L(_e(a),b);break}else o==2?L(_e(t[3]),b):(n=="L"&&(a=ue(atob(a))),L(fe(decodeURIComponent(atob(a))),b));w(p,g)}}function We(){if(b.some(e=>e.some(t=>t.piece))){let e=new URLSearchParams;e.set("cursor",`${g.x+1}-${g.y+1}`),e.set("spell","G1-"+Pe(ce(b,!1))),history.replaceState({},"",`${location.pathname}?${e}`)}else history.replaceState({},"",location.pathname)}const Ie="/assets/psi_spell_encode_wasm_bg-700d8052.wasm",Me="/assets/psi-8969a07a.html",De="/assets/phi-c032e098.html";await ge(Ie);const pe=9,F=pe,B=pe,Fe=document.querySelector("#spell-grid"),V=document.querySelector("#search"),Be=document.querySelector("#export"),Ve=document.querySelector("#import"),Ge=document.querySelector("#delete");let g={},p={element:document.querySelector("#piece-config"),controls:[],params:[],comment:null},b=qe(Fe,F,B,p,g);I(b,g,4,4);const J=document.querySelector("#piece-catalog");let A={};await Promise.allSettled([Me,De].map(Ke)),Re();async function Ke(e){let t=await Q(e),n=await Se(t);Object.assign(A,n),ze()}function ze(){J.innerHTML="",Object.values(A).sort((e,t)=>Z(e)>Z(t)).forEach(e=>{let t=J.div("catalog-item");t.append(e.cloneNode(!0)),t.addEventListener("click",()=>{E(g.cell,q(e)),w(p,g)})})}function He(){let e=V.value.toLowerCase();J.childNodes.forEach(t=>{let n=t.querySelector(".piece");t.hidden=!n.dataset.name.toLowerCase().includes(e)})}function be(){alert(Te(ce(b))),We()}function me(){L(fe(prompt("Spell JSON")),b),w(p,g)}function ye(){j(g.cell),w(p,g)}V.addEventListener("input",He),Be.addEventListener("click",be),Ve.addEventListener("click",me),Ge.addEventListener("click",ye);let X;document.addEventListener("keydown",e=>{if(e.getModifierState("Control")&&e.key=="d"&&(e.preventDefault(),p.comment&&(e.target==p.comment?document.activeElement.blur():p.comment.focus())),["INPUT","TEXTAREA"].includes(e.target.nodeName)){e.key=={INPUT:"Enter",TEXTAREA:"Escape"}[e.target.nodeName]&&(e.preventDefault(),document.activeElement.blur());return}if(e.key=="Enter"){V.focus(),V.select();return}if(Ee(e.key,g,p))return;["Delete","Backspace"].includes(e.key)&&ye(),"123456789".includes(e.key)&&(X=e.key);let t=p.params[X-1];if(t){e.key=="ArrowLeft"&&k(t,R(t)=="left"&&W(t)?"off":"left",g,p),e.key=="ArrowRight"&&k(t,R(t)=="right"&&W(t)?"off":"right",g,p),e.key=="ArrowUp"&&k(t,R(t)=="top"&&W(t)?"off":"top",g,p),e.key=="ArrowDown"&&k(t,R(t)=="bottom"&&W(t)?"off":"bottom",g,p);return}let n=g.x,o=g.y,a="off";if(e.key=="ArrowLeft"&&(n--,a="left"),e.key=="ArrowRight"&&(n++,a="right"),e.key=="ArrowUp"&&(o--,a="top"),e.key=="ArrowDown"&&(o++,a="bottom"),e.shiftKey&&Y(n,F)&&Y(o,B)&&a!="off"&&!b[n][o].piece){let r=q(A["psi:connector"]);k(r.querySelector(".param[data-key=_target]"),xe(a)),E(b[n][o],r)}I(b,g,O(n,F),O(o,B),p),e.key=="e"&&be(),e.key=="i"&&me()}),document.addEventListener("keyup",e=>{"123456789".includes(e.key)&&(X=null)}),document.addEventListener("contextmenu",e=>e.preventDefault())})();
